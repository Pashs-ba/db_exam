# Семафоры Дейкстра. Решение проблемы «производитель-потребитель» с помощью семафоров.
Semophore S - целая неотрицательная переменная, над которой определено 2 действия:
```cpp 
P(S) {
	while (S == 0) {ожидание}; S -= 1;
}

V(S) {
	S += 1
}
```

Просто увеличив количество семафоров до 3, можно решить задачу producer-consumer:
```cpp

shared mutex = 1;
shared empty = N;
shared full = 0;

Producer() {
	while (true) {
		produce_data();
		P(empty); // Ожидаем, пока в буфере появится свободное место
		P(mutex); // Захватываем мьютекс, исключая совместный доступ к буферу
		push_data(); // Кладем произведенные данные в буфер
		V(mutex); // Освобождаем мьютекс, позволяя другим потокам доступ к буферу
		V(full); // Увеличиваем семафор full -> буфер заполнен
	}
}

Consumer() {
	while (true) {
		P(full); // Ожидаем, пока в буфере появятся данные
		P(mutex); // Захватываем мьютекс, исключая совместный доступ к буферу
		get_data(); // Извлекаем данные из буфера
		V(mutex); // Освобождаем мьютекс, позволяя другим потокам доступ к буферу
		V(empty); // Увеличиваем семафор empty -> буфер пуст
		consume_data();
	}
}
```